pico-8 cartridge // http://www.pico-8.com
version 32
__lua__

left,right,up,down,fire1,fire2=0,1,2,3,4,5
black,dark_blue,dark_purple,dark_green,brown,dark_gray,light_gray,white,red,orange,yellow,green,blue,indigo,pink,peach=0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15

function _init()
    kiki = {
        dy= 0,
        dx= 0,
        x= 50,
        y= 50, 
        flip= false,
        dropCD= 0,
        dashCD= 0,
        dropDone=true,
    }

    cam = {
        x=0,
        y=0,
        maxDX=7,
        offsetX=64,
        offsetY=0,
    }

    frames = 0 
    air_resistance, acc, gravity = 0.95, 0.3, 0.1
end

function _update60()
    frames += 1
    local move = false
    if btn(left) then
        kiki["dx"] -= acc 
        kiki["flip"] = false
        move = true
    end
    if btn(right) then
        kiki["dx"] += acc 
        kiki["flip"] = true
        move = true
    end
    if btn(down) then
        kiki["dy"] += acc/2
    end
    if btn(up) then
        kiki["dy"] -= acc/2
    end

    -- drop
    kiki["dropCD"] -= 1
    if btnp(fire1) and kiki["dropCD"] <= 0 and kiki["dropDone"] then
        kiki["dy"] = 4
        kiki["dropCD"] = 30
        kiki["dropDone"] = false
        print("pressed", 10, 10, red)
    end
    if btn(fire1) then
        kiki["dx"] *= 0.2
    end
    if not btn(fire1) then
        kiki["dropDone"] = true
    end

    -- dash
    kiki["dashCD"] -= 1
    if btnp(fire2) and kiki["dashCD"] <= 0 then
        if kiki["flip"] then
            kiki["dx"] = 10
        else
            kiki["dx"] = -10
        end
        kiki["dashCD"] = 60
    end

    kiki["dx"] *= air_resistance
    kiki["dy"] *= air_resistance
    if kiki["y"] < 0 then
        kiki["dy"] += gravity
    end

    -- set kiki position
    kiki["x"] += kiki["dx"]
    kiki["y"] += kiki["dy"]
    if kiki["y"] > 110 and kiki["dy"] >= 0 then
        kiki["dy"] *= 0.2
        kiki["dx"] *= 0.2
    end

    -- set camera position
    moveCamera(kiki["x"], kiki["y"], not move, kiki["flip"])
end

function _draw()
    cls(blue)

    camera(cam["x"], cam["y"])

    map(0, 0, 0, 64, 128, 8)
    map(0, 8, 1024, 64, 128, 8)
    map(0, 16, 2048, 64, 128, 8)
    map(0, 24, 3072, 64, 128, 8)

    palt(blue, true)
    spr(1, kiki["x"], kiki["y"]+sin(frames/60)*1.5, 1, 1, kiki["flip"], false)
end

function moveCamera(x, y, center, faceRight)
    -- choose the goal point for the camera
    if center then
        cam["offsetX"] += (cam["offsetX"] - 64) * -0.05
        goal_x = x - cam["offsetX"]
    end
    if not center and faceRight then
        cam["offsetX"] += (cam["offsetX"] - 10) * -0.1
        goal_x = x - cam["offsetX"]
    end
    if not center and not faceRight then
        cam["offsetX"] += (cam["offsetX"] - 110) * -0.1
        goal_x = x - cam["offsetX"]
    end

    local camDX = (cam["x"] - goal_x) * -0.3
    if camDX > cam["maxDX"] then
        camDX = cam["maxDX"]
    end
    if camDX < -cam["maxDX"] then
        camDX = -cam["maxDX"]
    end

    cam["x"] += camDX

    cam["y"] += (cam["y"] - (y - 20)) * -0.05
    if cam["y"] > 0 then
        cam["y"] = 0
    end
end

__gfx__
00000000cccccccccccccccccccccccbccccc777777cccccccccccccccccccccccbbbbcc88888888cccccccc0000000000000000000000000000000000000000
00000000c888cccccccccccccccccbbbccc7777777777ccccccccccccccccccccbbbbbbc888888888ccccccc0000000000000000000000000000000000000000
00000000c88888cccbbbbbbcccccbbbbcc777777777777cccc0c0cccccccccccbbbbbbbb8888888888cccccc0000000000000000000000000000000000000000
00000000cc8888ccbbbbbbbbbbbbbbbbc77777777777777ccc0c0cccc00c00ccbbbbbbbb77777777cccccccc0000000000000000000000000000000000000000
00000000cc88888cbbbbbbbbbbbbbbbbc77777777777777cccc0ccccccc0cccc3bbbbbb376777677cccccccc0000000000000000000000000000000000000000
00000000cc888888bbbbbbbbbbbbbbbb7777777777777777cccccccccccccccc33bbbb33767776772222222c0000000000000000000000000000000000000000
0000000088888888bbbbbbbbbbbbbbbb7777777777777777ccccccccccccccccc333333c77777777222222220000000000000000000000000000000000000000
00000000cccccccccbbbbbbccccccccc7777777777777777cccccccccccccccccc3333cc77777777222722720000000000000000000000000000000000000000
00000000000000000000000000000000777777777777777700000000000000000000000066677766666766760000000000000000000000000000000000000000
00000000000000000000000000000000f77777777777777f000000000000000000000000fff777ff677777770000000000000000000000000000000000000000
00000000000000000000000000000000ff777777777777ff0000000000000000000000007ff777ff677777770000000000000000000000000000000000000000
00000000000000000000000000000000cff7777777777ffc000000000000000000000000767776f7677677670000000000000000000000000000000000000000
00000000000000000000000000000000cffff777777ffffc00000000000000000000000076777677677677670000000000000000000000000000000000000000
00000000000000000000000000000000ccffffffffffffcc000000000000000000000000f7777777677777770000000000000000000000000000000000000000
00000000000000000000000000000000cccffffffffffccc000000000000000000000000ff777f77666666660000000000000000000000000000000000000000
00000000000000000000000000000000cccccffffffccccc000000000000000000000000fff77ff7677777770000000000000000000000000000000000000000
__map__
0100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000090a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000000191a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
01000000090a0000090a00000000000000090a090a0000000000000000000000090a090a00000000000000090a000000090a0000000000000000090a0000000000000000090a090a090a0000090a090a090a00090a0000090a090a0000000000000000000000090a090a000000090a00000000090a0000090a090a0000000000
01000000191a0000191a00000000000000191a191a0000000000000000000000191a191a00000000000000191a000000191a090a090a090a090a19090a090a090a000000191a191a191a0000191a191a191a00191a0000191a191a0000000000000000000000191a191a000000191a00000000191a0000191a191a0000000000
090a090a090a090a09090a090a090a090a090a090a090a090a090a09090a090a090a09090a090a090a09090a090a090a090a191a090a090a090a0919090a090a090a090a090a090a090a090a090a090a09090a090a090a090a090a090a090a090a090a09090a090a09090a090a090a090a090a090a090a090a09090a090a090a
191a191a191a191a19191a191a191a191a191a191a191a191a191a19191a191a191a19191a191a191a19191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a19191a191a191a191a191a191a191a191a191a19191a191a19191a191a191a191a191a191a191a191a19191a191a191a
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000090a090a090a00000000000000000000000000000009090a090a0000000000000000000000000000000000090a090a0000000000000000000000000000000000090a0000000000000000000000000000000000000000000000090a00000000090a0000000000000000000000000000000000090a00000000000000
0000000000191a191a191a00000000000000000000090a090a090a191a191a0000000000000000090a090a0000000000191a191a0000000000000009090a0a090a090a0a00191a00090a090a090a090a00000000090a090a000000000000191a00000000191a00000000090a090a000000000000000000191a00000000000000
090a09090a090909090909090a0a090a090a090a09191a191a191a090909090a0a0a090a090a09191a191a090a090a09090a090a090a09090a090a19090a090a09191a0a0a090a09191a191a191a19090a090a09191a191a0a090a090a0909090a0a090a09090909090a191a191a090a090a090a090a0909090a090a090a090a
191a19191a191919191919191a1a191a191a191a191a191a191a19191919191a1a1a191a191a191a191a19191a191a19191a191a191a19191a191a19191a191a191a191a1a191a191a191a191a191a191a191a191a191a191a191a191a1919191a1a191a19191919191a191a191a191a191a191a191a1919191a191a191a191a
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000090a000000000000090a000000090a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000191a090a00000000191a000000191a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000090a000000000000090a00000000090a090a0000000000090a0000090a0000000000090a090a00000000000009090a191a00000000090a000000090a0000000000000000090a000000000000000000000000000000000000000000000000000000000000090a000000000000090a090a000000000000090a000000
0000000000191a000000000000191a00000000191a191a0000000000191a0000191a0000000000191a191a00000000000019090a090a00000000191a000000191a090a090a090a0009191a0a090a090a00000000000000090a090a090a090a00000000000000000000191a000000000000191a191a000000000000191a000000
09090a090a090a090a090a090a090a090a090a090a09090a090a090a090a090a09090a090a090a090a090a090a090a090a0919090a0a090a090a09090a090a090a090a090a090a0919090a090a090a090a090a090a090a191a191a191a19090a090a09090a090a090a090a090a090a090a090a090a090a090a090a090a090a09
19191a191a191a191a191a191a191a191a191a191a19191a191a191a191a191a19191a191a191a191a191a191a191a191a191a191a1a191a191a19191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a19191a191a19191a191a191a191a191a191a191a191a191a191a191a191a191a191a19
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001
0000090a090a090a00000000000000000000000000000000090a090a090a00000000000000000000000000000000000000090a090a0000090a000000000000000000000000000000000000090a090a000000000000090a090a090a000000090a090a000000000000000000000000090a090a00000000090a0000000000000001
0000191a191a191a00000000000000000000000000000000191a191a191a00000000000000000000000000000000000000191a191a0000191a000000000000000000000000000000000000191a191a000000000000191a191a191a000000191a191a000000000000000000000000191a191a00000000191a0000000000000001
090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a09090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a09090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a090a0901
191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a19191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a19191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a191a
